# Python HTTP æœåŠ¡å™¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº Flask çš„å¯æ‰©å±• HTTP æœåŠ¡å™¨ï¼Œæ”¯æŒåœ¨ä»»æ„ç¯å¢ƒä¸‹éƒ¨ç½²è¿è¡Œã€‚

## ğŸš€ ç‰¹æ€§

- **å¯ç§»æ¤æ€§** - ä½¿ç”¨åŠ¨æ€è·¯å¾„è§£æï¼Œæ— ç¡¬ç¼–ç è·¯å¾„ï¼Œæ”¯æŒä»»æ„æœåŠ¡å™¨ç¯å¢ƒ
- **é…ç½®é©±åŠ¨** - ç«¯å£ç­‰é…ç½®ä» `config/default.yaml` è¯»å–
- **æ¨¡å—åŒ–è®¾è®¡** - è·¯ç”±åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼
- **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ Python ç±»å‹æ³¨è§£

## ç›®å½•ç»“æ„

```
app/server/
â”œâ”€â”€ __init__.py           # æ¨¡å—åˆå§‹åŒ–æ–‡ä»¶
â”œâ”€â”€ main.py               # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ start_server.py       # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ requirements.txt      # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ routes/               # è·¯ç”±æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py      # è·¯ç”±æ³¨å†Œç®¡ç†
â”‚   â””â”€â”€ test_routes.py   # æµ‹è¯•è·¯ç”±
â””â”€â”€ README.md            # è¯´æ˜æ–‡æ¡£
```

## å®‰è£…ä¾èµ–

```bash
cd /Volumes/data/project/open-back/app/server
python3 -m pip install -r requirements.txt
```

## å¯åŠ¨æœåŠ¡å™¨

```bash
# æ–¹æ³•1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
./run.sh

# æ–¹æ³•2ï¼šç›´æ¥è¿è¡Œä¸»æ–‡ä»¶ï¼ˆè‡ªåŠ¨è®¾ç½®è·¯å¾„ï¼‰
python3 main.py

# æ–¹æ³•3ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
python3 start_server.py
```

## APIæ¥å£

### ğŸ”„ ç»Ÿä¸€APIè®¾è®¡

æ‰€æœ‰ä¸šåŠ¡APIæ¥å£éƒ½ä½¿ç”¨ `/api` è·¯å¾„ï¼Œé€šè¿‡POSTè¯·æ±‚çš„bodyæ¥åŒºåˆ†å…·ä½“çš„è·¯ç”±æ–¹æ³•ã€‚

**ç»Ÿä¸€è¯·æ±‚æ ¼å¼ï¼š**
```json
{
    "method": "æ–¹æ³•å",
    "data": {
        // å…·ä½“å‚æ•°
    }
}
```

**ç»Ÿä¸€å“åº”æ ¼å¼ï¼š**
```json
{
    "success": true/false,
    "message": "é”™è¯¯ä¿¡æ¯ï¼ˆæˆåŠŸæ—¶ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰",
    "data": {
        // å…·ä½“è¿”å›æ•°æ®
    }
}
```

### POST /test
æµ‹è¯•æ¥å£ï¼Œè¿”å›hello worldæ¶ˆæ¯

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://127.0.0.1:8081/test \
  -H "Content-Type: application/json" \
  -d '{"test": "data"}'
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "",
  "data": {
    "endpoint": "/test",
    "method": "POST",
    "received_data": {"test": "data"},
    "message": "hello world"
  }
}
```

### POST /api
ç»Ÿä¸€çš„ä¸šåŠ¡APIæ¥å£

#### getStrategy - è·å–ç­–ç•¥åˆ—è¡¨

ä»æ•°æ®åº“è·å–ç­–ç•¥æ•°æ®ï¼Œæ”¯æŒåˆ†é¡µã€æ’åºåŠŸèƒ½ã€‚

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://127.0.0.1:8081/api \
  -H "Content-Type: application/json" \
  -d '{
    "method": "getStrategy",
    "data": {
      "page": 1,
      "pageSize": 10,
      "orderBy": "sharpe_ratio",
      "order": "desc"
    }
  }'
```

**å‚æ•°è¯´æ˜ï¼š**
- `page` (number, å¯é€‰): å½“å‰é¡µï¼Œé»˜è®¤ä¸º1
- `pageSize` (number, å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤ä¸º20ï¼Œæœ€å¤§100
- `orderBy` (string, å¯é€‰): æ’åºå­—æ®µï¼Œå¯é€‰å€¼ï¼š
  - `sharpe_ratio` - å¤æ™®æ¯”ç‡
  - `findal_balance` - æœ€ç»ˆä½™é¢
  - `max_drawdown` - æœ€å¤§å›æ’¤
  - `trade_count` - äº¤æ˜“æ¬¡æ•°
  - `total_commission` - æ€»æ‰‹ç»­è´¹
  - `winning_percetage` - èƒœç‡
- `order` (string, å¯é€‰): æ’åºæ–¹å‘ï¼Œ`asc`ï¼ˆå‡åºï¼‰æˆ–`desc`ï¼ˆé™åºï¼‰ï¼Œé»˜è®¤ä¸º`asc`

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "message": "",
  "data": {
    "strategies": [
      {
        "id": 4785,
        "name": "2025-09-03_11:13:39_3997",
        "currency": "ETHUSDT",
        "time_interval": "1d",
        "sharpe_ratio": 0.2151745578620255,
        "findal_balance": 10106.48,
        "max_drawdown": 0.001910950442166647,
        "trade_count": 1,
        "total_commission": 9.61,
        "winning_percetage": 1.0,
        "init_balance": 10000.0,
        "reason": "auto-generated by doubao16Thinking",
        "extra": "{...}",
        "created_at": "2025-09-03T11:13:51",
        "updated_at": "2025-09-03T11:13:51"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 10,
      "total": 6880,
      "totalPages": 688,
      "hasNext": true,
      "hasPrev": false
    },
    "sorting": {
      "orderBy": "final_balance",
      "order": "desc"
    }
  }
}
```

### GET /api/health
å¥åº·æ£€æŸ¥æ¥å£

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X GET http://127.0.0.1:8081/api/health
```

### GET /api/users
è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆç¤ºä¾‹æ¥å£ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X GET http://127.0.0.1:8081/api/users
```

### POST /api/users
åˆ›å»ºæ–°ç”¨æˆ·ï¼ˆç¤ºä¾‹æ¥å£ï¼‰

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST http://127.0.0.1:8081/api/users \
  -H "Content-Type: application/json" \
  -d '{"name": "ç‹äº”", "email": "wangwu@example.com"}'
```

## æ·»åŠ æ–°çš„ API æ¥å£

1. åœ¨ `routes/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶ï¼Œä¾‹å¦‚ `user_routes.py`
2. åœ¨æ–°æ–‡ä»¶ä¸­å®šä¹‰è·¯ç”±å‡½æ•°
3. åœ¨ `routes/__init__.py` ä¸­å¯¼å…¥å¹¶æ³¨å†Œæ–°çš„è·¯ç”±

**ç¤ºä¾‹ï¼š**

```python
# routes/user_routes.py
from flask import Flask, jsonify

def register_user_routes(app: Flask) -> None:
    @app.route('/users', methods=['GET'])
    def get_users():
        return jsonify({"users": []})
```

```python
# routes/__init__.py
from .user_routes import register_user_routes

def register_routes(app: Flask) -> None:
    register_test_routes(app)
    register_user_routes(app)  # æ·»åŠ æ–°è·¯ç”±
```

## é…ç½®

æœåŠ¡å™¨ç«¯å£é€šè¿‡ `config/default.yaml` æ–‡ä»¶ä¸­çš„ `server.port` é…ç½®é¡¹æ§åˆ¶ã€‚
é…ç½®æ–‡ä»¶é€šè¿‡ `core/config/index.py` æ¨¡å—è¯»å–ã€‚
